#!/bin/bash

start=`date +%s`

die () {
    echo >&2 "$@"
    exit 1
}

[ "$#" -eq 1 ] || die "1 argument required, $# provided"

(
  cd server || exit;
  webpack;
) &

(
  cd test || exit;
  webpack;
) & wait;

node --enable-source-maps test -v --deploy "${@: -1}"

end=`date +%s.%N`

runtime=$( echo "$end - $start" | bc -l )

echo "Deployment total time: $runtime"
